# STM32 串口通信实战：从零到数据收发

串口通信（UART）是嵌入式开发中最基础也最常用的通信方式之一。这篇文章记录使用 STM32 HAL 库实现串口通信的过程。

## 硬件准备

- STM32F103C8T6（蓝色药丸）
- USB-TTL 转换器
- 杜邦线若干

## 三种通信模式

### 1. 轮询模式

最简单的方式，CPU 一直等待数据发送/接收完成。

```c
// 发送数据
HAL_UART_Transmit(&huart1, (uint8_t*)"Hello\r\n", 7, HAL_MAX_DELAY);

// 接收数据
uint8_t rxData[10];
HAL_UART_Receive(&huart1, rxData, 10, 1000);
```

### 2. 中断模式

数据收发完成后触发中断，CPU 可以做其他事情。

```c
// 中断接收
HAL_UART_Receive_IT(&huart1, rxBuffer, 1);

// 回调函数
void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart) {
    if (huart->Instance == USART1) {
        // 处理接收到的数据
        HAL_UART_Receive_IT(&huart1, rxBuffer, 1);
    }
}
```

### 3. DMA 模式

适合大量数据传输，完全不占用 CPU。

## 性能对比

| 模式 | CPU 占用 | 适用场景 | 复杂度 |
|------|---------|---------|--------|
| 轮询 | 高 | 简单调试 | 低 |
| 中断 | 中 | 常规通信 | 中 |
| DMA | 低 | 大数据量 | 高 |

## 踩坑记录

> 调试时一定要检查波特率是否匹配，这个问题浪费了我整整一个下午。

下一步计划研究 I2C 和 SPI 通信协议。
